<!doctype html>
<!--
TODO:
* Google Site Verification
* REPLACE |***CAMPAIGN_NAME***|
* Replace |***CAMPAIGN_ADDRESS***|
* Replace |***OG_[IMAGE, URL, TITLE, DESCRIPTION]****|
* Replace |***TWITTER_[ID, AUTHOR, DESCRIPTION, TITLE, IMAGE]***|
* Replace |***TITLE***|
* Replace |***TWITTER_MESSAGE***|
* Replace |***HOST_EVENT***|http://action.page/s/fbct-host?source=map
* !!!! GOOGLE ANALYTICS!!!
-->
<meta charset="utf-8" />
<meta name='google-site-verification' content='' />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<meta name="description" content="Working Families Party">
<meta name="keywords" content="Working Families Party">
<meta property="og:image" content="|***OG_IMAGE***|" />
<meta property="og:url" content="http://map.workingfamilies.org" />
<meta property="og:title" content="Working Families Party"/>
<meta property="og:description" content="|***OG_DESCRIPTION***|"/>


<link rel="canonical" href="http://map.workingfamilies.org">
<meta property="twitter:card" content="summary_large_image">
<meta property="twitter:site" content="http://map.workingfamilies.org">
<meta property="twitter:site:id" content="|***TWITTER_ID***|">
<meta property="twitter:author" content="|***TWITTER_AUTHOR***|">
<meta property="twitter:description" content="|***TWITTER_DESCRIPTION***|">
<meta property="twitter:title" content="|***TWITTER_TITLE***|">
<meta property="twitter:image" content="|***TWITTER_IMAGE***|">

<link href='//api.tiles.mapbox.com/mapbox.js/v2.1.9/mapbox.css' rel='stylesheet' />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<link rel="shortcut icon" href="favicon.ico" type="image/x-icon">

<link rel="stylesheet" type="text/css" href="./css/events-map.css">
<link rel='stylesheet' type='text/css' href='https://fonts.googleapis.com/css?family=Montserrat:300,400,500' />
<title>Working Families Party</title>
<!-- Global Site Tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-107554084-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-107554084-2');
</script>

<!--[if lte IE 9]>
       <meta http-equiv="refresh" content="0; url=https://go./page/event/search_simple" />
<![endif]-->
<body class='list-view initial-view'>
  <div id="fb-root"></div>
  <script>(function(d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return;
    js = d.createElement(s); js.id = id;
    js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.8&appId=1682756452019911";
    fjs.parentNode.insertBefore(js, fjs);
  }(document, 'script', 'facebook-jssdk'));</script>

<section id='header'>
<div id="header" class='primary_font'>

  <div class="main-title-area">
    <div style="">
      <div id='spiel'></div>
    </div>
    <span id='main-title-meta'>Elect progressive heroes in 2018</span>
  </div>

  <nav>
    <ul id="nav" class='nav'>
      <li>
        <a class="twitter-share-button"
          data-url="http://map.workingfamilies.org"
          href="|***TWITTER_MESSAGE***|">
          Tweet</a>
      </li>
      <li>
        <div class="fb-share-button" data-href="http://map.workingfamilies.org" data-layout="button" data-size="small" data-mobile-iframe="true"><a class="fb-xfbml-parse-ignore" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fmap.workingfamilies.org&amp;src=sdkpreparse">Share</a></div>
      </li>
      <li>
        <a class='contribute' href='https://actionnetwork.org/events/new?event_campaign_id=5032'>Host an Event</a>
      </li>
    </ul>
  </nav>
  <div style="clear: both"></div>
</div>
</section>
<section id='activity-area' class='clearfix'>
  <article id='events'>
    <div id='filters'>
      <div id='loading-icon' class='primary_font'>Loading...</div>
      <h3 id='switch-link'>
          <a href='javascript: void(null)' onclick='window.mapManager.toMapView()' id='to-map-view'>
            <span>List View</span>
            <img src='/img/icon/list-icon.png' width='28px'/>
          </a>
          <a href='javascript: void(null)' onclick='window.mapManager.toListView()' id='to-list-view'>
            <span>Map View</span>
            <img src='/img/icon/map-icon.png' width='28px'/>
          </a>
      </h3>
      <h4 class='primary_font title'>
        <span id='screen-title'>Filters</span>
        <span id='mobile-title'></span>
      </h4>
      <form id='filter-form'>
        <table>
          <tr>
            <td>
              <h5 class='primary_font'>By Zipcode</h5>
              <input type='number' name='zipcode' maxlength='5' placeholder='ZIPCODE' onclick="this.select();" >
            </td>
            <td>
              <h5 class='primary_font'>Distance</h5>
              <select name='distance'>
                <option value='5'>5mi</option>
                <option value='20'>20mi</option>
                <option value='50' selected='selected'>50mi</option>
                <option value='100'>100mi</option>
              </select>
            </td>
            <td>
              <h5 class='primary_font'>Sort By</h5>
              <select name='sort'>
                <option value='time' selected='selected'>Time</option>
                <option value='distance'>Distance</option>
              </select>
              <input type='button' style='position: absolute; z-index: -1; opacity: 0;' id='hidden-button'/>
            </td>
          </tr>
        </table>
        <!-- <div id='filter-popup-area' class='montserrat'>
          <a href='javascript: void(null)' class='filter-button show-filter' onclick='$("#events").addClass("show-type-filter");'>
            Search by Type
          </a>
          <div id='filter-list-area'>
            <h5>Search by Type</h5>
            <div id='f-container'>
              <div id='filter-list-container'>
                <ul id='filter-list'></ul>
              </div>
              <div style='text-align: center; font-size: 11px; margin-top: 10px; color: lightgray;'>
              <a href='javascript: void(null)' id='show-all'
                 onclick='$("#filter-list").find("input[type=checkbox]").prop("checked", true).trigger("change");'>Show All</a> &bull;
              <a href='javascript: void(null)'
                 onclick='$("#filter-list").find("input[type=checkbox]").prop("checked", false).trigger("change")'>Hide All</a>
              </div>
            </div>
            <p align='right'>
              <a href='javascript: void(null)' class='filter-button'
                 onclick='$("#events").removeClass("show-type-filter");'>
                Hide Legend
              </a>
            </p>
          </div>
        </div> -->
        <nav id='mobile-nav'>
          <a href="https://actionnetwork.org/events/399e719e860e4ffff8cb415b19513c08bad2d808/edit" class="contribute" target="_blank">
            <img src='https://d80vmbqb0w49q.cloudfront.net/img/icon/add-icon.png' width='28px'/>
          </a>
        </nav>
      </form>
    </div>
    <div id='event-list-container'>
      <ul id='event-list'>
        <li class='montserrat' id='init-item'>
          <span>Find an event near you!<br/><br/>Type in your <strong>zipcode</strong> to view nearby meetings and events.</span>
        </li></ul>
      <footer>
        <div id='footer-area' >
          <h3 class='secondary_font' style='line-height: 1.25'>Working Families Party</h3>
          <p class='secondary_font'>1 Metrotech Center North 11th Fl, Brooklyn NY 11201</p>
          <br/><br/>
          <sub><a href='http://workingfamilies.org/privacy-policy/'>Privacy Policy</a></sub>
        </div>

      </footer>
    </div>
  </article>
  <article id='map'>
    <div id='map-container'></div>
  </article>
</section>
<section id='campaign-offices'>
  <div class='viewport'>
    <h3 class='title'>Nearby Campaign Offices</h3>
    <a class='close-button primary_font' href='javascript: void(null);' onclick='$("body").removeClass("show-office")'>x</a>
    <div class='container'>
      <ul id='campaign-office-list'></ul>
    </div>
  </div>
</section>

<script src="https://d2zfgjd0dxweyq.cloudfront.net/js/jquery.gz"></script>
<script src='https://d2zfgjd0dxweyq.cloudfront.net/js/d3.gz' type='text/javascript'></script>
<script id='zipcodes-datadump' type='text/plain'></script>
<script src='https://d2zfgjd0dxweyq.cloudfront.net/js/deparam.min.gz'></script>
<script src='https://d2zfgjd0dxweyq.cloudfront.net/js/mapbox.gz'></script>
<!-- <script src='/js/leaflet-bouncer.js'></script> -->
<script src='https://d2zfgjd0dxweyq.cloudfront.net/js/moment.min.js'></script>
<script src='https://d2zfgjd0dxweyq.cloudfront.net/js/js-cookie.js'></script>
<script src='/js/MapManagerTranspiled.js'></script>
<script type='text/javascript'>
window.eventTypeFilters = [
  {
    name: 'Canvassing',
    id: 'canvassing',
  },
  {
    name: 'Phonebanking',
    id: 'phonebanking'
  },
  {
    name: 'Other',
    id: 'other'
  }
];
</script>
<script type='text/javascript'>
(function($, d3) {
  window.EVENTS_DATA = [];
  var date = new Date();
  $("#loading-icon").show();

  $.ajax({
    url: 'https://dnb6leangx6dc.cloudfront.net/output/workingfamilies.js.gz', //'|**DATA_SOURCE**|',
    dataType: 'script',
    cache: true, // otherwise will get fresh copy every page load
    success: function(data) {
      d3.csv('//d1y0otadi3knf6.cloudfront.net/d/us_postal_codes.gz',
        function(zipcodes) {
          $("#loading-icon").hide();
          //Clean data
          // window.EVENTS_DATA = data;/
          window.EVENTS_DATA.forEach(function(d) {
            d.filters = [];
            //Set filter info
            switch (d.event_type) {
              case "Canvassing":
                d.filters.push('canvassing');
                break;
              case "Phonebanking":
                d.filters.push('phonebanking');
                break;
              default:
                d.filters.push('other');
                break;
            }

            d.is_official = d.is_official == "1";
            if (d.is_official) {
              d.filters.push("official-event");
            }
          });
          var params = $.deparam(window.location.hash.substring(1))
          var oldDate = new Date();

          /* Extract default lat lon */
          var m = /.*\?c=(.+?),(.+?),(\d+)z#?.*/g.exec(window.location.href)
          if (m && m[1] && m[2] && m[3]) {
            var defaultCoord = {
              center: [parseFloat(m[1]), parseFloat(m[2])],
              zoom: parseInt(m[3])
            };

            window.mapManager = MapManager(window.EVENTS_DATA, campaignOffices, zipcodes, {
              defaultCoord: defaultCoord
            });

            window.mapManager.filterByCoords(defaultCoord.center, 50, params.sort, params.f);
          } else {
            window.mapManager = MapManager(window.EVENTS_DATA, null, zipcodes);
          }

          // Load Connecticut area

          /*** TOTALLY OPTIONAL AREA FOR FOCUSED AREAS. EXAMPLE IS CONNETICUT ***/
          /*** TODO: Repalace/Remove this ***/
          // $.ajax({
          //   dataType: "json",
          //   url: "d/ct.geojson",
          //   success: function(data) {
          //     $(data.geometries).each(function(key, data) {
          //       district_boundary
          //         .addData(data)
          //         .setStyle({
          //           fillColor: 'transparent',
          //           color: 'rgb(0, 134, 178)'
          //         });
          //       if (!params.zipcode || params.zipcode === '') {
          //         window.mapManager.getMap()
          //           .fitBounds(district_boundary.getBounds());
          //       }
          //     });
          //
          //   }
          // }).error(function() {});

          if ($("input[name='zipcode']").val() == '' && Cookies.get('map.bernie.zipcode') && window.location.hash == '') {
            $("input[name='zipcode']").val(Cookies.get('map.bernie.zipcode'));
            window.location.hash = $("#filter-form").serialize();
          } else {
            $(window).trigger("hashchange");
          }
        });
    }
  });

  /** initial loading before activating listeners...*/
  var params = $.deparam(window.location.hash.substring(1));
  if (params.zipcode) {
    $("input[name='zipcode']").val(params.zipcode);
  }

  if (params.distance) {
    $("select[name='distance']").val(params.distance);
  }
  if (params.sort) {
    $("select[name='sort']").val(params.sort);
  }

  /* Prepare filters */
  $("#filter-list").append(
    window.eventTypeFilters.map(function(d) {
      return $("<li />")
        .append(
          $("<input type='checkbox' class='filter-type' />")
          .attr('name', 'f[]')
          .attr("value", d.id)
          .attr("id", d.id)
          .prop("checked", !params.f ? true : $.inArray(d.id, params.f) >= 0)
        )
        .append($("<label />").attr('for', d.id)
        .append($("<span />").addClass('filter-on')
        .append(d.onItem ? d.onItem : $("<span>").addClass('circle-button default-on')))
        .append($("<span />").addClass('filter-off')
        .append(d.offItem ? d.offItem : $("<span>").addClass('circle-button default-off')))
        .append($("<span>").text(d.name)));
    })
  );
  /***
   *  define events
   */
  //only numbers
  $("input[name='zipcode']").on('keyup keydown', function(e) {
    if (e.type == 'keydown' && (e.keyCode < 48 || e.keyCode > 57) &&
      e.keyCode != 8 && !(e.keyCode >= 37 || e.keyCode <= 40)) {
      return false;
    }

    if (e.type == 'keyup' && $(this).val().length == 5) {
      if (!(e.keyCode >= 37 && e.keyCode <= 40)) {
        $(this).closest("form#filter-form").submit();
        $("#hidden-button").focus();
      }
    }
  });

  /***
   *  onchange of select
   */
  $("select[name='distance'],select[name='sort']").on('change', function(e) {
    $(this).closest("form#filter-form").submit();
  });

  /**
   * On filter type change
   */
  $(".filter-type").on('change', function(e) {
    $(this).closest("form#filter-form").submit();
  })

  //On submit
  $("form#filter-form").on('submit', function(e) {
    var serial = $(this).serialize();
    window.location.hash = serial;
    e.preventDefault();
    return false;
  });

  $(window).on('hashchange', function(e) {

    var hash = window.location.hash;
    if (hash.length == 0 || hash.substring(1) == 0) {
      $("#loading-icon").hide();
      return false;
    }

    var params = $.deparam(hash.substring(1));

    //Custom feature for specific default lat/lon
    //lat=40.7415479&lon=-73.8239609&zoom=17
    setTimeout(function() {
      $("#loading-icon").show();

      if (window.mapManager._options && window.mapManager._options.defaultCoord && params.zipcode.length != 5) {
        console.log("XXX");
        window.mapManager.filterByType(params.f);
        window.mapManager.filterByCoords(window.mapManager._options.defaultCoord.center, params.distance, params.sort, params.f);
      } else {
        console.log("YYYx");
        window.mapManager.filterByType(params.f);
        window.mapManager.filter(params.zipcode, params.distance, params.sort, params.f);
      }
      $("#loading-icon").hide();

    }, 10);
    // $("#loading-icon").hide();
    if (params.zipcode.length == 5 && $("body").hasClass("initial-view")) {
      $("#events").removeClass("show-type-filter");
      $("body").removeClass("initial-view");
    }
  });

  var pre = $.deparam(window.location.hash.substring(1));
  if ($("body").hasClass("initial-view")) {
    if ($(window).width() >= 600 && (!pre.zipcode || pre && pre.zipcode.length != 5)) {
      $("#events").addClass("show-type-filter");
    }
  }

})(jQuery, d3);

</script>
<!-- Twitter -->
<script>window.twttr = (function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0],
    t = window.twttr || {};
  if (d.getElementById(id)) return t;
  js = d.createElement(s);
  js.id = id;
  js.src = "https://platform.twitter.com/widgets.js";
  fjs.parentNode.insertBefore(js, fjs);

  t._e = [];
  t.ready = function(f) {
    t._e.push(f);
  };

  return t;
}(document, "script", "twitter-wjs"));</script>

<!-- SOCIAL -->
  <script></script>


</body>
